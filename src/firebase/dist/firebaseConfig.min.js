"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpcomingWeekClasses=exports.addClassToTimetable=exports.getTodayClasses=exports.subscribeCourseTimetable=exports.subscribeLecturerTimetable=exports.getDepartmentTimetable=exports.getCourseTimetable=exports.getLecturerTimetable=exports.ensureCollectionExists=exports.signInUser=exports.createNewUser=exports.validateEmailByRole=exports.checkClassRepExists=exports.getAdminCount=exports.isValidStudentEmail=exports.isValidLecturerEmail=exports.checkAdminRegistrationStatus=exports.checkCourseHasRep=exports.countUsersByRole=exports.checkEmailExists=exports.updateUserProfile=exports.resendVerificationEmail=exports.signOutUser=exports.getCurrentUser=exports.db=exports.auth=exports.app=void 0;var _app=require("firebase/app"),_auth=require("firebase/auth"),_firestore=require("firebase/firestore");function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,s)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var firebaseConfig={apiKey:"AIzaSyAwruoIL8WpN7AzgAmNTW8ZYcZZny1qZs0",authDomain:"tumcalendar-75b52.firebaseapp.com",projectId:"tumcalendar-75b52",storageBucket:"tumcalendar-75b52.appspot.com",messagingSenderId:"606128397684",appId:"1:606128397684:web:0fc57fde30a1cd2d1ee021",measurementId:"G-5C1KWE2HH6"},app=(0,_app.initializeApp)(firebaseConfig);exports.app=app;var auth=(0,_auth.getAuth)(app);exports.auth=auth;var db=(0,_firestore.getFirestore)(app);exports.db=db,(0,_auth.setPersistence)(auth,_auth.browserSessionPersistence).catch(function(e){console.error("Firebase persistence error:",e)});var initializeFirestore=function(){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,_firestore.query)((0,_firestore.collection)(db,"users"),(0,_firestore.where)("role","==","admin")),e.next=4,regeneratorRuntime.awrap((0,_firestore.getDocs)(r));case 4:return console.log("Firestore users collection is ready"),e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),console.log("Initializing Firestore connection:",e.t0.message),e.abrupt("return",!1);case 12:case"end":return e.stop()}},null,null,[[0,8]])};initializeFirestore();var getCurrentUser=function(){return new Promise(function(n,e){var o=(0,_auth.onAuthStateChanged)(auth,function(r){var t,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(o(),r)return e.prev=2,e.next=5,regeneratorRuntime.awrap((0,_firestore.getDoc)((0,_firestore.doc)(db,"users",r.uid)));e.next=41;break;case 5:if((t=e.sent).exists())return s=t.data(),console.log("User data retrieved from Firestore:",s),e.prev=9,e.next=12,regeneratorRuntime.awrap((0,_firestore.updateDoc)((0,_firestore.doc)(db,"users",r.uid),{lastLogin:(new Date).toISOString()}));e.next=20;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),console.warn("Could not update last login time:",e.t0);case 17:n(_objectSpread({},r,{},s)),e.next=33;break;case 20:return console.warn("User exists in Auth but not in Firestore. Creating Firestore record..."),e.prev=21,a={email:r.email,role:"unknown",emailVerified:r.emailVerified,createdAt:(new Date).toISOString(),lastLogin:(new Date).toISOString(),approved:!1},e.next=25,regeneratorRuntime.awrap((0,_firestore.setDoc)((0,_firestore.doc)(db,"users",r.uid),a));case 25:console.log("Created missing user document in Firestore"),n(_objectSpread({},r,{},a)),e.next=33;break;case 29:e.prev=29,e.t1=e.catch(21),console.error("Failed to create missing user document:",e.t1),n(r);case 33:e.next=39;break;case 35:e.prev=35,e.t2=e.catch(2),console.error("Error getting user profile:",e.t2),n(r);case 39:e.next=42;break;case 41:n(null);case 42:case"end":return e.stop()}},null,null,[[2,35],[9,14],[21,29]])},e)})};exports.getCurrentUser=getCurrentUser;var signOutUser=function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap((0,_auth.signOut)(auth));case 3:return e.abrupt("return",{success:!0,message:"Logged out successfully"});case 6:return e.prev=6,e.t0=e.catch(0),console.error("Error signing out:",e.t0),e.abrupt("return",{success:!1,error:e.t0.message});case 10:case"end":return e.stop()}},null,null,[[0,6]])};exports.signOutUser=signOutUser;var resendVerificationEmail=function(r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!r.emailVerified)return e.abrupt("return",(0,_auth.sendEmailVerification)(r));e.next=2;break;case 2:throw new Error("User is already verified or not available");case 3:case"end":return e.stop()}})};exports.resendVerificationEmail=resendVerificationEmail;var updateUserProfile=function(r,t){var s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=(0,_firestore.doc)(db,"users",r),e.next=4,regeneratorRuntime.awrap((0,_firestore.getDoc)(s));case 4:if(e.sent.exists())return e.next=8,regeneratorRuntime.awrap((0,_firestore.updateDoc)(s,_objectSpread({},t,{updatedAt:(new Date).toISOString()})));e.next=11;break;case 8:return e.abrupt("return",{success:!0});case 11:return e.next=13,regeneratorRuntime.awrap((0,_firestore.setDoc)(s,_objectSpread({},t,{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})));case 13:return e.abrupt("return",{success:!0});case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(0),console.error("Error updating user profile:",e.t0),e.abrupt("return",{success:!1,error:e.t0.message});case 20:case"end":return e.stop()}},null,null,[[0,16]])};exports.updateUserProfile=updateUserProfile;var checkEmailExists=function(r){var t,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,_firestore.collection)(db,"users"),s=(0,_firestore.query)(t,(0,_firestore.where)("email","==",r)),e.next=5,regeneratorRuntime.awrap((0,_firestore.getDocs)(s));case 5:return a=e.sent,e.abrupt("return",!a.empty);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error checking email:",e.t0),e.abrupt("return",!1);case 13:case"end":return e.stop()}},null,null,[[0,9]])};exports.checkEmailExists=checkEmailExists;var countUsersByRole=function(r){var t,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,_firestore.collection)(db,"users"),s=(0,_firestore.query)(t,(0,_firestore.where)("role","==",r)),e.next=5,regeneratorRuntime.awrap((0,_firestore.getDocs)(s));case 5:return a=e.sent,e.abrupt("return",a.size);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error counting users by role:",e.t0),e.abrupt("return",0);case 13:case"end":return e.stop()}},null,null,[[0,9]])};exports.countUsersByRole=countUsersByRole;var checkAdminRegistrationStatus=function(r){var t,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,_firestore.query)((0,_firestore.collection)(db,"users"),(0,_firestore.where)("email","==",r)),e.next=4,regeneratorRuntime.awrap((0,_firestore.getDocs)(t));case 4:if(e.sent.empty){e.next=7;break}return e.abrupt("return",{canRegister:!1,message:"This email address is already registered in the system"});case 7:return s=(0,_firestore.query)((0,_firestore.collection)(db,"users"),(0,_firestore.where)("role","==","admin")),e.next=10,regeneratorRuntime.awrap((0,_firestore.getDocs)(s));case 10:if(a=e.sent,a.size<2)return e.abrupt("return",{canRegister:!0,message:""});e.next=14;break;case 14:return e.abrupt("return",{canRegister:!1,message:"Maximum number of administrators (2) has been reached. Please contact system support."});case 17:return e.prev=17,e.t0=e.catch(0),console.error("Error checking admin registration status:",e.t0),e.abrupt("return",{canRegister:!0,message:"Could not verify administrator limits. Proceeding with registration."});case 21:case"end":return e.stop()}},null,null,[[0,17]])};exports.checkAdminRegistrationStatus=checkAdminRegistrationStatus;var checkCourseHasRep=function(r){var t,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,_firestore.collection)(db,"users"),s=(0,_firestore.query)(t,(0,_firestore.where)("role","==","class_rep"),(0,_firestore.where)("course","==",r)),e.next=5,regeneratorRuntime.awrap((0,_firestore.getDocs)(s));case 5:return a=e.sent,e.abrupt("return",!a.empty);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error checking course rep:",e.t0),e.abrupt("return",!1);case 13:case"end":return e.stop()}},null,null,[[0,9]])};exports.checkCourseHasRep=checkCourseHasRep;var isValidLecturerEmail=function(e){return e.endsWith("@tum.ac.ke")&&!e.includes("@students.tum.ac.ke")};exports.isValidLecturerEmail=isValidLecturerEmail;var isValidStudentEmail=function(e,r){return!!r&&new RegExp("^".concat(r,"\\/[0-9]+[A-Z]?\\/[0-9]{4}@students\\.tum\\.ac\\.ke$"),"i").test(e)};exports.isValidStudentEmail=isValidStudentEmail;var getAdminCount=function(){var r,t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,_firestore.query)((0,_firestore.collection)(db,"users"),(0,_firestore.where)("role","==","admin")),e.next=4,regeneratorRuntime.awrap((0,_firestore.getDocs)(r));case 4:return t=e.sent,e.abrupt("return",t.size);case 8:return e.prev=8,e.t0=e.catch(0),console.error("Error checking admin count:",e.t0),e.abrupt("return",0);case 12:case"end":return e.stop()}},null,null,[[0,8]])};exports.getAdminCount=getAdminCount;var checkClassRepExists=function(r){var t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,_firestore.query)((0,_firestore.collection)(db,"users"),(0,_firestore.where)("role","==","class_rep"),(0,_firestore.where)("course","==",r)),e.next=4,regeneratorRuntime.awrap((0,_firestore.getDocs)(t));case 4:return s=e.sent,e.abrupt("return",0<s.size);case 8:return e.prev=8,e.t0=e.catch(0),console.error("Error checking class rep:",e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}},null,null,[[0,8]])};exports.checkClassRepExists=checkClassRepExists;var validateEmailByRole=function(r,t,s,a){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r&&t){e.next=3;break}return e.abrupt("return",{valid:!1,error:"Email and role are required"});case 3:return e.next=5,regeneratorRuntime.awrap(getAdminCount());case 5:n=e.sent,e.t0=t,e.next="admin"===e.t0?9:"lecturer"===e.t0?12:"class_rep"===e.t0?18:31;break;case 9:if(2<=n)return e.abrupt("return",{valid:!1,error:"Maximum number of administrators (2) already registered"});e.next=11;break;case 11:return e.abrupt("return",{valid:!0,error:""});case 12:if(/^[a-zA-Z0-9._%+-]+@tum\.ac\.ke$/.test(r))return e.abrupt("return",{valid:!0,error:""});e.next=17;break;case 17:return e.abrupt("return",{valid:!1,error:"Lecturer email must be a valid university email (e.g., janedoe@tum.ac.ke)"});case 18:if(s&&a){e.next=20;break}return e.abrupt("return",{valid:!1,error:"Please select both department and course first"});case 20:return e.next=22,regeneratorRuntime.awrap(checkClassRepExists(a));case 22:if(e.sent)return e.abrupt("return",{valid:!1,error:"A class representative for ".concat(a," already exists")});e.next=25;break;case 25:if(new RegExp("^".concat(a,"\\/[0-9]+[A-Z]?\\/[0-9]{4}@students\\.tum\\.ac\\.ke$"),"i").test(r))return e.abrupt("return",{valid:!0,error:""});e.next=30;break;case 30:return e.abrupt("return",{valid:!1,error:"Class rep email must follow the format: ".concat(a,"/STUDENTNUMBER/YEAR@students.tum.ac.ke")});case 31:return e.abrupt("return",{valid:!1,error:"Invalid role selected"});case 32:e.next=38;break;case 34:return e.prev=34,e.t1=e.catch(0),console.error("Error validating email:",e.t1),e.abrupt("return",{valid:!1,error:"Error validating email. Please try again."});case 38:case"end":return e.stop()}},null,null,[[0,34]])};exports.validateEmailByRole=validateEmailByRole;var createNewUser=function(r,t,s,a,n){var o,i,u,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(checkEmailExists(r));case 3:if(e.sent)return e.abrupt("return",{success:!1,message:"This email is already registered. Please use a different email or login."});e.next=6;break;case 6:if("admin"===s)return e.next=9,regeneratorRuntime.awrap(checkAdminRegistrationStatus(r));e.next=12;break;case 9:if((o=e.sent).canRegister){e.next=12;break}return e.abrupt("return",{success:!1,message:o.message});case 12:return e.next=14,regeneratorRuntime.awrap((0,_auth.createUserWithEmailAndPassword)(auth,r,t));case 14:return i=e.sent,console.log("User created in Authentication:",i.user.uid),u=_objectSpread({email:i.user.email,role:s,emailVerified:i.user.emailVerified,createdAt:(new Date).toISOString(),lastLogin:(new Date).toISOString(),approved:"admin"===s},"class_rep"===s&&{department:a,course:n},{},"lecturer"===s&&{department:a}),e.next=19,regeneratorRuntime.awrap((0,_firestore.setDoc)((0,_firestore.doc)(db,"users",i.user.uid),u));case 19:return console.log("User data saved to Firestore"),e.abrupt("return",{success:!0,message:"admin"===s?"Admin account created successfully! You may now log in.":"Account created! Awaiting admin approval. You'll be notified once approved.",user:i.user});case 23:return e.prev=23,e.t0=e.catch(0),console.error("Error creating new user:",e.t0),c=e.t0.message,"auth/email-already-in-use"===e.t0.code?c="This email is already registered. Please use a different email or login.":"auth/invalid-email"===e.t0.code?c="Invalid email format. Please check and try again.":"auth/weak-password"===e.t0.code&&(c="Password is too weak. Please use a stronger password."),e.abrupt("return",{success:!1,message:c,error:e.t0});case 29:case"end":return e.stop()}},null,null,[[0,23]])};exports.createNewUser=createNewUser;var signInUser=function(r,t){var s,a,n,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap((0,_auth.signInWithEmailAndPassword)(auth,r,t));case 3:return s=e.sent,console.log("User authenticated successfully:",s.user.uid),e.next=7,regeneratorRuntime.awrap((0,_firestore.getDoc)((0,_firestore.doc)(db,"users",s.user.uid)));case 7:if((a=e.sent).exists()){e.next=14;break}return console.warn("User not found in Firestore. Creating profile..."),n={email:s.user.email,emailVerified:s.user.emailVerified,role:"unknown",createdAt:(new Date).toISOString(),lastLogin:(new Date).toISOString(),approved:!1},e.next=13,regeneratorRuntime.awrap((0,_firestore.setDoc)((0,_firestore.doc)(db,"users",s.user.uid),n));case 13:return e.abrupt("return",{success:!0,message:"Logged in successfully, but profile is incomplete. Please contact an administrator.",user:_objectSpread({},s.user,{},n)});case 14:return o=a.data(),e.next=17,regeneratorRuntime.awrap((0,_firestore.updateDoc)((0,_firestore.doc)(db,"users",s.user.uid),{lastLogin:(new Date).toISOString()}));case 17:if(o.approved||"admin"===o.role){e.next=19;break}return e.abrupt("return",{success:!1,message:"Your account is pending approval. Please check back later or contact an administrator.",user:null});case 19:return e.abrupt("return",{success:!0,message:"Logged in successfully!",user:_objectSpread({},s.user,{},o)});case 22:e.prev=22,e.t0=e.catch(0),console.error("Login error:",e.t0),e.t1=e.t0.code,e.next="auth/user-not-found"===e.t1?28:"auth/wrong-password"===e.t1?28:"auth/too-many-requests"===e.t1?30:"auth/user-disabled"===e.t1?32:34;break;case 28:return i="Invalid email or password. Please try again.",e.abrupt("break",35);case 30:return i="Too many unsuccessful login attempts. Please try again later or reset your password.",e.abrupt("break",35);case 32:return i="This account has been disabled. Please contact an administrator.",e.abrupt("break",35);case 34:i="Failed to login. Please try again.";case 35:return e.abrupt("return",{success:!1,message:i,error:e.t0});case 36:case"end":return e.stop()}},null,null,[[0,22]])};exports.signInUser=signInUser;var ensureCollectionExists=function(r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,_firestore.doc)((0,_firestore.collection)(db,r),"dummy"),e.next=4,regeneratorRuntime.awrap((0,_firestore.setDoc)(t,{dummy:!0}));case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error ensuring ".concat(r," collection exists:"),e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}},null,null,[[0,7]])};exports.ensureCollectionExists=ensureCollectionExists;var getLecturerTimetable=function(r){var t,s,a,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r){e.next=4;break}return console.error("Lecturer email is required"),e.abrupt("return",[]);case 4:return t=(0,_firestore.collection)(db,"timetable"),s=(0,_firestore.query)(t,(0,_firestore.where)("lecturerEmail","==",r)),e.next=8,regeneratorRuntime.awrap((0,_firestore.getDocs)(s));case 8:return a=e.sent,n=[],a.forEach(function(e){n.push(_objectSpread({id:e.id},e.data()))}),e.abrupt("return",n);case 14:return e.prev=14,e.t0=e.catch(0),console.error("Error fetching lecturer timetable:",e.t0),e.abrupt("return",[]);case 18:case"end":return e.stop()}},null,null,[[0,14]])};exports.getLecturerTimetable=getLecturerTimetable;var getCourseTimetable=function(r){var t,s,a,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r){e.next=4;break}return console.error("Course code is required"),e.abrupt("return",[]);case 4:return t=(0,_firestore.collection)(db,"timetable"),s=(0,_firestore.query)(t,(0,_firestore.where)("course","==",r)),e.next=8,regeneratorRuntime.awrap((0,_firestore.getDocs)(s));case 8:return a=e.sent,n=[],a.forEach(function(e){n.push(_objectSpread({id:e.id},e.data()))}),e.abrupt("return",n);case 14:return e.prev=14,e.t0=e.catch(0),console.error("Error fetching course timetable:",e.t0),e.abrupt("return",[]);case 18:case"end":return e.stop()}},null,null,[[0,14]])};exports.getCourseTimetable=getCourseTimetable;var getDepartmentTimetable=function(r){var t,s,a,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r){e.next=4;break}return console.error("Department is required"),e.abrupt("return",[]);case 4:return t=(0,_firestore.collection)(db,"timetable"),s=(0,_firestore.query)(t,(0,_firestore.where)("department","==",r)),e.next=8,regeneratorRuntime.awrap((0,_firestore.getDocs)(s));case 8:return a=e.sent,n=[],a.forEach(function(e){n.push(_objectSpread({id:e.id},e.data()))}),e.abrupt("return",n);case 14:return e.prev=14,e.t0=e.catch(0),console.error("Error fetching department timetable:",e.t0),e.abrupt("return",[]);case 18:case"end":return e.stop()}},null,null,[[0,14]])};exports.getDepartmentTimetable=getDepartmentTimetable;var subscribeLecturerTimetable=function(e,t){if(!e)return console.error("Lecturer email is required"),function(){};var r=(0,_firestore.collection)(db,"timetable"),s=(0,_firestore.query)(r,(0,_firestore.where)("lecturerEmail","==",e));return(0,_firestore.onSnapshot)(s,function(e){var r=[];e.forEach(function(e){r.push(_objectSpread({id:e.id},e.data()))}),t(r)},function(e){console.error("Error subscribing to lecturer timetable:",e),t([])})};exports.subscribeLecturerTimetable=subscribeLecturerTimetable;var subscribeCourseTimetable=function(e,t){if(!e)return console.error("Course code is required"),function(){};var r=(0,_firestore.collection)(db,"timetable"),s=(0,_firestore.query)(r,(0,_firestore.where)("course","==",e));return(0,_firestore.onSnapshot)(s,function(e){var r=[];e.forEach(function(e){r.push(_objectSpread({id:e.id},e.data()))}),t(r)},function(e){console.error("Error subscribing to course timetable:",e),t([])})};exports.subscribeCourseTimetable=subscribeCourseTimetable;var getTodayClasses=function(r,t){var s,a,n,o,i,u,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r&&t){e.next=4;break}return console.error("User type and identifier are required"),e.abrupt("return",[]);case 4:s=new Date,a=new Date(s.setHours(0,0,0,0)).toISOString(),n=new Date(s.setHours(23,59,59,999)).toISOString(),i=(0,_firestore.collection)(db,"timetable"),e.t0=r,e.next="lecturer"===e.t0?11:"class_rep"===e.t0?13:"admin"===e.t0?15:17;break;case 11:return o=(0,_firestore.query)(i,(0,_firestore.where)("lecturerEmail","==",t),(0,_firestore.where)("date",">=",a),(0,_firestore.where)("date","<=",n)),e.abrupt("break",18);case 13:return o=(0,_firestore.query)(i,(0,_firestore.where)("course","==",t),(0,_firestore.where)("date",">=",a),(0,_firestore.where)("date","<=",n)),e.abrupt("break",18);case 15:return o=(0,_firestore.query)(i,(0,_firestore.where)("date",">=",a),(0,_firestore.where)("date","<=",n)),e.abrupt("break",18);case 17:return e.abrupt("return",[]);case 18:return e.next=20,regeneratorRuntime.awrap((0,_firestore.getDocs)(o));case 20:return u=e.sent,c=[],u.forEach(function(e){c.push(_objectSpread({id:e.id},e.data()))}),e.abrupt("return",c);case 26:return e.prev=26,e.t1=e.catch(0),console.error("Error fetching today's classes:",e.t1),e.abrupt("return",[]);case 30:case"end":return e.stop()}},null,null,[[0,26]])};exports.getTodayClasses=getTodayClasses;var addClassToTimetable=function(r){var t,s,a,n,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r){e.next=3;break}return e.abrupt("return",{success:!1,message:"Class data is required"});case 3:t=0,s=["course","lecturerEmail","date","startTime","endTime","room"];case 5:if(!(t<s.length)){e.next=12;break}if(a=s[t],r[a]){e.next=9;break}return e.abrupt("return",{success:!1,message:"".concat(a," is required")});case 9:t++,e.next=5;break;case 12:return n=_objectSpread({},r,{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}),o=(0,_firestore.collection)(db,"timetable"),e.next=16,regeneratorRuntime.awrap((0,_firestore.setDoc)((0,_firestore.doc)(o),n));case 16:return i=e.sent,e.abrupt("return",{success:!0,message:"Class added successfully",id:i.id});case 20:return e.prev=20,e.t0=e.catch(0),console.error("Error adding class to timetable:",e.t0),e.abrupt("return",{success:!1,message:e.t0.message});case 24:case"end":return e.stop()}},null,null,[[0,20]])};exports.addClassToTimetable=addClassToTimetable;var getUpcomingWeekClasses=function(r,t){var s,a,n,o,i,u,c,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r&&t){e.next=4;break}return console.error("User type and identifier are required"),e.abrupt("return",[]);case 4:s=new Date,a=new Date(s.setHours(0,0,0,0)).toISOString(),(n=new Date(s)).setDate(n.getDate()+7),o=new Date(n.setHours(23,59,59,999)).toISOString(),u=(0,_firestore.collection)(db,"timetable"),e.t0=r,e.next="lecturer"===e.t0?13:"class_rep"===e.t0?15:"admin"===e.t0?17:19;break;case 13:return i=(0,_firestore.query)(u,(0,_firestore.where)("lecturerEmail","==",t),(0,_firestore.where)("date",">=",a),(0,_firestore.where)("date","<=",o)),e.abrupt("break",20);case 15:return i=(0,_firestore.query)(u,(0,_firestore.where)("course","==",t),(0,_firestore.where)("date",">=",a),(0,_firestore.where)("date","<=",o)),e.abrupt("break",20);case 17:return i=(0,_firestore.query)(u,(0,_firestore.where)("date",">=",a),(0,_firestore.where)("date","<=",o)),e.abrupt("break",20);case 19:return e.abrupt("return",[]);case 20:return e.next=22,regeneratorRuntime.awrap((0,_firestore.getDocs)(i));case 22:return c=e.sent,l=[],c.forEach(function(e){l.push(_objectSpread({id:e.id},e.data()))}),e.abrupt("return",l);case 28:return e.prev=28,e.t1=e.catch(0),console.error("Error fetching upcoming week's classes:",e.t1),e.abrupt("return",[]);case 32:case"end":return e.stop()}},null,null,[[0,28]])};exports.getUpcomingWeekClasses=getUpcomingWeekClasses;
//# sourceMappingURL=firebaseConfig.min.js.map
